# Thar Kubernetes Conformance Testing
`setup-test-cluster.sh` sets up an EKS cluster and generates an env file containing cluster information and the user data used to launch Thar worker nodes.
 
`run-conformance-test.sh` uses the generated env file to launch specified number of worker nodes in the described EKS cluster and runs Kubernetes conformance tests.
Once the tests are done, the script outputs the test results in the current directory and cleans up the worker nodes.

`clean-up-test-cluster` deletes the EKS test cluster specified by the env file and any files generated by `setup-test-cluster.sh`.
 
## Running conformance tests against Thar nodes using these scripts:
1. Run `setup-test-cluster.sh` to set up a test cluster:
   ```
   setup-test-cluster.sh --region us-west-2 --cluster-name my-test-cluster
   ```
   Once the setup completes successfully, there should be a user data file and an env file in the current directory.
2. Run `run-conformance-test.sh` to launch Thar worker nodes and run the Kubernetes conformance test:
   ```
   run-conformance-test.sh --node-ami ami-07245e9300b9290c1 \
     --cluster-env-file my-test-cluster.env 
     --instance-type m5.large \
     --num-nodes 3
   ```
3. The Sonobuoy Kubernetes conformance test results can be examined with:
   ```
   sonobuoy results my-test-cluster-conformance-test-results/TIMESTAMP.tar.gz
   ```
4. To clean up the test cluster and other associated resources, run `clean-up-test-cluster.sh`:
   ```
   clean-up-test-cluster.sh --cluster-env-file my-test-cluster.env
   ```
