version: 0.2

env:
  variables:
    # Path to infra tooling directory.
    INFRA_DIR: "./tools/infra"

phases:
  pre_build:
    commands:
      - start-build-environment
      - environment-report
      - write-build-meta
  build:
    commands:
      - cargo make world

artifacts:
  base-directory: 'build/'
  files:
    - '*.img*'
    - '*.ext4*'
    - '*.verity*'
  secondary-artifacts:
    meta:
      base-directory: 'build/meta'
      files:
        - '*'
